!function(){"use strict";class e{constructor(){this.pathToTownshipsImages="assets/img/dist/townships",this.wrapEl=document.querySelector(".card__wrap"),this.likedCountEl=document.querySelector(".main-header__liked-count"),this.numberOfCards=12,this.arrayLiked=[],this.quantityTownshipsEl=document.querySelector(".h1__number")}renderQuantityTownships(e){this.quantityTownshipsEl.textContent=e.length}createArrayLiked(t){for(let e=0;e<t.length;e++)this.arrayLiked[e]={id:t[e].id,liked:!1}}addSelectSortingClickListeners(a){document.querySelectorAll(".sorting .option").forEach(e=>{e.addEventListener("click",e=>{var t=document.querySelector(".tab.active").dataset.tab;this.sortingCards(e.currentTarget.dataset.value,t,a),this.addButtonMore(a,t),this.addCardHoverListeners(),this.setTownshipsLiked()})})}sortingCards(e,t,a){switch(e){case"relevance":a.sort((e,t)=>parseFloat(e.id)-parseFloat(t.id)),this.insertTownshipsIntoPage(t,a);break;case"cheaper":a.sort((e,t)=>parseFloat(e.minCostHundred)-parseFloat(t.minCostHundred)),this.insertTownshipsIntoPage(t,a);break;case"expensive":a.sort((e,t)=>parseFloat(t.minCostHundred)-parseFloat(e.minCostHundred)),this.insertTownshipsIntoPage(t,a);break;case"distance":a.sort((e,t)=>parseFloat(e.distance)-parseFloat(t.distance)),this.insertTownshipsIntoPage(t,a)}}renderCategoryTownships(t,e){var a="all",s=this.getNumberCardsCategory(a,t);this.setCostHundred(t,e),this.createArrayLiked(t),this.renderQuantityTownships(t),this.addSelectSortingClickListeners(t),this.insertTownshipsIntoPage(a,t),this.changeStyleBtn(document.querySelector(".tab")),this.addButtonMore(t,a,s),this.addCardHoverListeners(),this.chooseCategory(t),this.addHashPageHashChangeListeners(t),document.querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",()=>{this.activateTab(e,e.dataset.tab,t)})})}setCostHundred(e,t){for(var a of e)for(var s of t){var r;s.townshipId==a.id&&(r=this.getMinCostHundred(t,s.townshipId),s=this.getOldMinCostHundred(t,s.townshipId),a.minCostHundred=r,a.oldMinCostHundred=s)}}getOldMinCostHundred(t,a){var s=[];let r=0;for(let e=0;e<t.length;e++)t[e].townshipId==a&&null!=t[e].priceOld&&(s[r]=(t[e].priceOld/t[e].area).toFixed(0),r++);return Math.min(...s)}getMinCostHundred(t,a){var s=[];let r=0;for(let e=0;e<t.length;e++)t[e].townshipId==a&&(s[r]=(t[e].price/t[e].area).toFixed(0),r++);return Math.min(...s)}activateTab(e,t,a){var s=this.getNumberCardsCategory(t,a);this.insertTownshipsIntoPage(t,a),this.changeStyleBtn(e),this.setTownshipsLiked(),this.addButtonMore(a,t,s),this.addCardHoverListeners(),this.changeHashPage(t)}getNumberCardsCategory(t,e){let a=0;for(var s of e){if("all"==t)return a=e.length;s.labels.forEach(e=>{e==t&&a++})}return a}changeHashPage(e){"all"==e?history.pushState("",document.title,window.location.href.replace(/\#(.+)/,"").replace(/http(s?)\:\/\/([^\/]+)/,"")):window.location.hash="#"+e}chooseCategory(e){switch(location.hash.replace(/#/,"")){case"moscow":this.activateTab(document.querySelector('[data-tab="moscow"]'),"moscow",e);break;case"water":this.activateTab(document.querySelector('[data-tab="water"]'),"water",e);break;case"forest":this.activateTab(document.querySelector('[data-tab="forest"]'),"forest",e);break;default:this.activateTab(document.querySelector('[data-tab="all"]'),"all",e)}}addHashPageHashChangeListeners(t){window.addEventListener("hashchange",()=>{var e=location.hash.replace(/#/,"");this.activateTab(document.querySelector(`[data-tab="${e}"]`),e,t)})}addCardBottomHoverListeners(){document.querySelectorAll(".card__bottom").forEach(e=>{let t=e.parentElement,a=t.querySelector(".chevron");e.addEventListener("mouseover",()=>{t.classList.add("active"),a.classList.add("active")}),e.addEventListener("mouseout",()=>{t.classList.remove("active"),a.classList.remove("active")})})}addChevronHoverListeners(){document.querySelectorAll(".chevron").forEach(e=>{let t=e.parentElement;e.addEventListener("mouseover",()=>{t.classList.add("active")}),e.addEventListener("mouseout",()=>{t.classList.remove("active")})})}addCardHoverListeners(){this.addCardBottomHoverListeners(),this.addChevronHoverListeners()}addButtonMore(s,r,e){if(e>this.numberOfCards){this.wrapEl.insertAdjacentHTML("beforeend",'<button type="button" class="button card__more">Показать еще</button>');e=document.querySelector(".card__more");let a="";e.addEventListener("click",()=>{for(let t=0;t<s.length;t++)"all"==r?a+=this.getTownshipMarkup(s[t]):s[t].labels.forEach(e=>{e==r&&(a+=this.getTownshipMarkup(s[t]))});this.wrapEl.innerHTML="",this.wrapEl.insertAdjacentHTML("afterbegin",a),this.addButtonLikedClickListeners(),this.setTownshipsLiked(),this.addCardHoverListeners()})}}changeStyleBtn(e){document.querySelector(".tab.active")&&document.querySelector(".tab.active").classList.remove("active"),e.classList.add("active")}insertTownshipsIntoPage(t,a){let s="",r=0,i=0;for(;r<this.numberOfCards&&i<a.length;)"all"==t?(s+=this.getTownshipMarkup(a[i]),r++):a[i].labels.forEach(e=>{e==t&&(s+=this.getTownshipMarkup(a[i]),r++)}),i++;this.wrapEl.innerHTML="",this.wrapEl.insertAdjacentHTML("afterbegin",s),this.addButtonLikedClickListeners()}addButtonLikedClickListeners(){document.querySelectorAll(".liked").forEach(t=>{t.addEventListener("click",()=>{var e=t.parentElement.dataset.township;t.querySelector(".liked__icon").classList.contains("active")?(this.arrayLiked[e].liked=!1,this.likedCountEl.dataset.quantity=+this.likedCountEl.dataset.quantity-1):(this.arrayLiked[e].liked=!0,this.likedCountEl.dataset.quantity=+this.likedCountEl.dataset.quantity+1),this.setTownshipsLiked(),this.likedCountEl.textContent=this.likedCountEl.dataset.quantity})})}setTownshipsLiked(){for(var e of this.arrayLiked){var t=document.querySelector(`[data-township="${e.id}"]`);t&&(1==e.liked?t.querySelector(".liked__icon").classList.add("active"):t.querySelector(".liked__icon").classList.remove("active"))}}formatNumber(e){return e.toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}getLabelsTownshipMarkup(t){let a="";for(let e=0;e<t.labels.length;e++)switch(t.labels[e]){case"moscow":a+='<a href="townships.html#moscow" class="label">Ближе к Москве</a>';break;case"water":a+='<a href="townships.html#water" class="label">У воды</a>';break;case"forest":a+='<a href="townships.html#forest" class="label">У леса</a>'}return a}getPriceTownshipMarkup(e){return`<span class="card__price">от <span class="card__price_big">${this.formatNumber(e.minCostHundred)}</span> руб/сот.</span>`}getPriceOldTownshipMarkup(e){return e.oldMinCostHundred!=1/0?`<span class="card__price card__price_old">от ${this.formatNumber(e.oldMinCostHundred)} руб/сот.</span>`:""}getTownshipMarkup(e){var t=this.getLabelsTownshipMarkup(e),a=this.getPriceTownshipMarkup(e),s=this.getPriceOldTownshipMarkup(e);return`
			<div class="card__inner" style="background: center / cover no-repeat url(${this.pathToTownshipsImages}/${e.imageMiddle});" data-township="${e.id}">
				<div class="card__labels">
					${t}
				</div>
				<button type="button" class="liked card__liked" aria-label="Поставить / убрать лайк">
					<svg width="28" height="23" viewBox="0 0 28 23" xmlns="http://www.w3.org/2000/svg" class="liked__icon">
						<path
							d="M24.3473 2.78577C23.7271 2.16522 22.9906 1.67295 22.1801 1.33709C21.3695 1.00124 20.5007 0.828369 19.6233 0.828369C18.7459 0.828369 17.8771 1.00124 17.0666 1.33709C16.256 1.67295 15.5196 2.16522 14.8993 2.78577L13.612 4.07303L12.3248 2.78577C11.0719 1.53288 9.3726 0.829019 7.60075 0.829019C5.8289 0.829019 4.12962 1.53288 2.87673 2.78577C1.62385 4.03866 0.919983 5.73794 0.919983 7.50979C0.919983 9.28164 1.62385 10.9809 2.87673 12.2338L4.164 13.5211L13.612 21.8651L23.0601 13.5211L24.3473 12.2338C24.9679 11.6135 25.4601 10.8771 25.796 10.0665C26.1319 9.25597 26.3047 8.38717 26.3047 7.50979C26.3047 6.6324 26.1319 5.7636 25.796 4.95304C25.4601 4.14248 24.9679 3.40603 24.3473 2.78577Z"
							stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
					</svg>
				</button>
				<a href="town-card.html#${e.id}" class="card__bottom">
					<div class="card__bottom-inner">
						<h2 class="h3 card__name">${e.name}</h2>
						<div class="card__prices">
							${s}
							${a}
						</div>
						<span class="card__distance card__distance_township">${e.distance} км. от МКАД</span>
					</div>
				</a>
				<a href="town-card.html#${e.id}" class="chevron card__chevron" aria-label="Смотреть полную информацию о поселке">
					<svg width="8" height="12" viewBox="0 0 8 12" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M1.5 11L6.5 6L1.5 1" stroke="white" stroke-width="1.5" stroke-linecap="round"
							stroke-linejoin="round" />
					</svg>
				</a>
			</div>
			`}}window.addEventListener("load",()=>{NiceSelect.bind(document.querySelector("#sorting")),(new e).renderCategoryTownships(townships,plots)})}();